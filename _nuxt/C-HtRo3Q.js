var w=Object.defineProperty,C=(a,e,t)=>e in a?w(a,e,{enumerable:!0,configurable:!0,writable:!0,value:t}):a[e]=t,A=(a,e,t)=>C(a,typeof e!="symbol"?e+"":e,t);const R={"#":{pattern:/[0-9]/},"@":{pattern:/[a-zA-Z]/},"*":{pattern:/[a-zA-Z0-9]/}},N=(a,e,t)=>a.replaceAll(e,"").replace(t,".").replace("..",".").replace(/[^.\d]/g,""),I=(a,e,t)=>{var s;return new Intl.NumberFormat(((s=t.number)==null?void 0:s.locale)??"en",{minimumFractionDigits:a,maximumFractionDigits:e,roundingMode:"trunc"})},P=(a,e=!0,t)=>{var s,r,n,l;const u=((s=t.number)==null?void 0:s.unsigned)!==!0&&a.startsWith("-")?"-":"",p=((r=t.number)==null?void 0:r.fraction)??0;let o=I(0,p,t);const k=o.formatToParts(1000.12),m=((n=k.find(i=>i.type==="group"))==null?void 0:n.value)??" ",f=((l=k.find(i=>i.type==="decimal"))==null?void 0:l.value)??".",c=N(a,m,f);if(Number.isNaN(parseFloat(c)))return u;const v=c.split(".");if(v[1]!=null&&v[1].length>=1){const i=v[1].length<=p?v[1].length:p;o=I(i,p,t)}let d=o.format(parseFloat(c));return e?p>0&&c.endsWith(".")&&!c.slice(0,-1).includes(".")&&(d+=f):d=N(d,m,f),u+d};class T{constructor(e={}){A(this,"opts",{}),A(this,"memo",new Map);const t={...e};if(t.tokens!=null){t.tokens=t.tokensReplace?{...t.tokens}:{...R,...t.tokens};for(const s of Object.values(t.tokens))typeof s.pattern=="string"&&(s.pattern=new RegExp(s.pattern))}else t.tokens=R;Array.isArray(t.mask)&&(t.mask.length>1?t.mask=[...t.mask].sort((s,r)=>s.length-r.length):t.mask=t.mask[0]??""),t.mask===""&&(t.mask=null),this.opts=t}masked(e){return this.process(String(e),this.findMask(String(e)))}unmasked(e){return this.process(String(e),this.findMask(String(e)),!1)}isEager(){return this.opts.eager===!0}isReversed(){return this.opts.reversed===!0}completed(e){const t=this.findMask(String(e));if(this.opts.mask==null||t==null)return!1;const s=this.process(String(e),t).length;return typeof this.opts.mask=="string"?s>=this.opts.mask.length:s>=t.length}findMask(e){const t=this.opts.mask;if(t==null)return null;if(typeof t=="string")return t;if(typeof t=="function")return t(e);const s=this.process(e,t.slice(-1).pop()??"",!1);return t.find(r=>this.process(e,r,!1).length>=s.length)??""}escapeMask(e){const t=[],s=[];return e.split("").forEach((r,n)=>{r==="!"&&e[n-1]!=="!"?s.push(n-s.length):t.push(r)}),{mask:t.join(""),escaped:s}}process(e,t,s=!0){if(this.opts.number!=null)return P(e,s,this.opts);if(t==null)return e;const r=`v=${e},mr=${t},m=${s?1:0}`;if(this.memo.has(r))return this.memo.get(r);const{mask:n,escaped:l}=this.escapeMask(t),u=[],p=this.opts.tokens!=null?this.opts.tokens:{},o=this.isReversed()?-1:1,k=this.isReversed()?"unshift":"push",m=this.isReversed()?0:n.length-1,f=this.isReversed()?()=>i>-1&&h>-1:()=>i<n.length&&h<e.length,c=b=>!this.isReversed()&&b<=m||this.isReversed()&&b>=m;let v,d=-1,i=this.isReversed()?n.length-1:0,h=this.isReversed()?e.length-1:0,M=!1;for(;f();){const b=n.charAt(i),g=p[b],y=(g==null?void 0:g.transform)!=null?g.transform(e.charAt(h)):e.charAt(h);if(!l.includes(i)&&g!=null?(y.match(g.pattern)!=null?(u[k](y),g.repeated?(d===-1?d=i:i===m&&i!==d&&(i=d-o),m===d&&(i-=o)):g.multiple&&(M=!0,i-=o),i+=o):g.multiple?M&&(i+=o,h-=o,M=!1):y===v?v=void 0:g.optional&&(i+=o,h-=o),h+=o):(s&&!this.isEager()&&u[k](b),y===b&&!this.isEager()?h+=o:v=b,this.isEager()||(i+=o)),this.isEager())for(;c(i)&&(p[n.charAt(i)]==null||l.includes(i));){if(s){if(u[k](n.charAt(i)),e.charAt(h)===n.charAt(i)){i+=o,h+=o;continue}}else n.charAt(i)===e.charAt(h)&&(h+=o);i+=o}}return this.memo.set(r,u.join("")),this.memo.get(r)}}const S=a=>JSON.parse(a.replaceAll("'",'"')),F=(a,e={})=>{const t={...e};a.dataset.maska!=null&&a.dataset.maska!==""&&(t.mask=W(a.dataset.maska)),a.dataset.maskaEager!=null&&(t.eager=E(a.dataset.maskaEager)),a.dataset.maskaReversed!=null&&(t.reversed=E(a.dataset.maskaReversed)),a.dataset.maskaTokensReplace!=null&&(t.tokensReplace=E(a.dataset.maskaTokensReplace)),a.dataset.maskaTokens!=null&&(t.tokens=x(a.dataset.maskaTokens));const s={};return a.dataset.maskaNumberLocale!=null&&(s.locale=a.dataset.maskaNumberLocale),a.dataset.maskaNumberFraction!=null&&(s.fraction=parseInt(a.dataset.maskaNumberFraction)),a.dataset.maskaNumberUnsigned!=null&&(s.unsigned=E(a.dataset.maskaNumberUnsigned)),(a.dataset.maskaNumber!=null||Object.values(s).length>0)&&(t.number=s),t},E=a=>a!==""?!!JSON.parse(a):!0,W=a=>a.startsWith("[")&&a.endsWith("]")?S(a):a,x=a=>{if(a.startsWith("{")&&a.endsWith("}"))return S(a);const e={};return a.split("|").forEach(t=>{const s=t.split(":");e[s[0]]={pattern:new RegExp(s[1]),optional:s[2]==="optional",multiple:s[2]==="multiple",repeated:s[2]==="repeated"}}),e};class O{constructor(e,t={}){A(this,"items",new Map),A(this,"eventAbortController"),A(this,"onInput",s=>{if(s instanceof CustomEvent&&s.type==="input"&&!s.isTrusted&&!s.bubbles)return;const r=s.target,n=this.items.get(r);if(n===void 0)return;const l="inputType"in s&&s.inputType.startsWith("delete"),u=n.isEager(),p=l&&u&&n.unmasked(r.value)===""?"":r.value;this.fixCursor(r,l,()=>this.setValue(r,p))}),this.options=t,this.eventAbortController=new AbortController,this.init(this.getInputs(e))}update(e={}){this.options={...e},this.init(Array.from(this.items.keys()))}updateValue(e){var t;e.value!==""&&e.value!==((t=this.processInput(e))==null?void 0:t.masked)&&this.setValue(e,e.value)}destroy(){this.eventAbortController.abort(),this.items.clear()}init(e){const t=this.getOptions(this.options);for(const s of e){if(!this.items.has(s)){const{signal:n}=this.eventAbortController;s.addEventListener("input",this.onInput,{capture:!0,signal:n})}const r=new T(F(s,t));this.items.set(s,r),queueMicrotask(()=>this.updateValue(s)),s.selectionStart===null&&r.isEager()&&console.warn("Maska: input of `%s` type is not supported",s.type)}}getInputs(e){return typeof e=="string"?Array.from(document.querySelectorAll(e)):"length"in e?Array.from(e):[e]}getOptions(e){const{onMaska:t,preProcess:s,postProcess:r,...n}=e;return n}fixCursor(e,t,s){var r,n;const l=e.selectionStart,u=e.value;if(s(),l===null||l===u.length&&!t)return;const p=e.value,o=u.slice(0,l),k=p.slice(0,l),m=(r=this.processInput(e,o))==null?void 0:r.unmasked,f=(n=this.processInput(e,k))==null?void 0:n.unmasked;if(m===void 0||f===void 0)return;let c=l;o!==k&&(c+=t?p.length-u.length:m.length-f.length),e.setSelectionRange(c,c)}setValue(e,t){const s=this.processInput(e,t);s!==void 0&&(e.value=s.masked,this.options.onMaska!=null&&(Array.isArray(this.options.onMaska)?this.options.onMaska.forEach(r=>r(s)):this.options.onMaska(s)),e.dispatchEvent(new CustomEvent("maska",{detail:s})),e.dispatchEvent(new CustomEvent("input",{detail:s.masked})))}processInput(e,t){const s=this.items.get(e);if(s===void 0)return;let r=t??e.value;this.options.preProcess!=null&&(r=this.options.preProcess(r));let n=s.masked(r);return this.options.postProcess!=null&&(n=this.options.postProcess(n)),{masked:n,unmasked:s.unmasked(r),completed:s.completed(r)}}}export{T as Mask,O as MaskInput,R as tokens};
